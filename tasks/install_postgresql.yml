---

- name: Import PostgreSQL repository key
  apt_key: url=http://apt.postgresql.org/pub/repos/apt/ACCC4CF8.asc
  sudo: true

- name: Add PostgreSQL repository
  apt_repository: repo='deb http://apt.postgresql.org/pub/repos/apt/ {{ ansible_lsb.codename }}-pgdg main' state=present
  sudo: true

- name: Install PostgreSQL
  apt: pkg={{ item }} state=latest
  with_items:
    - postgresql-{{ pg_version }}
    - postgresql-client-{{ pg_version }}
    - postgresql-contrib
    - libpq-dev
  sudo: true

- name: Configure PostgreSQL to listen all networks
  replace:
    dest: /etc/postgresql/{{ pg_version }}/main/postgresql.conf
    regexp: "^#listen_addresses = 'localhost'"
    replace: "listen_addresses = '*'"
  notify:
    - restart postgresql
  sudo: true